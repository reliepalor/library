<!DOCTYPE html>
<html>
<head>
    <title>Profile Picture Upload Test</title>
    <style>
        .profile-container {
            position: relative;
            display: inline-block;
        }
        
        .profile-image {
            width: 128px;
            height: 128px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .edit-button {
            position: absolute;
            bottom: 0;
            right: 0;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            padding: 8px;
            cursor: pointer;
        }
        
        .confirmation-buttons {
            position: absolute;
            bottom: 0;
            right: 0;
            display: none;
        }
        
        .confirm-button {
            background: #10b981;
            color: white;
            border-radius: 50%;
            padding: 8px;
            cursor: pointer;
            margin-right: 4px;
        }
        
        .cancel-button {
            background: #ef4444;
            color: white;
            border-radius: 50%;
            padding: 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Profile Picture Upload Test</h1>
    
    <form id="profile-form" enctype="multipart/form-data">
        <div class="profile-container">
            <img id="profile-preview" src="https://via.placeholder.com/128" alt="Profile Picture" class="profile-image">
            
            <!-- Hidden file input inside the form for proper submission -->
            <input id="profile_picture" name="profile_picture" type="file" accept="image/*" style="display: none;">
            
            <div id="upload-section" class="edit-button">
                <span>✏️</span>
            </div>
            
            <div id="confirm-section" class="confirmation-buttons">
                <button id="confirm-upload-btn" type="button" class="confirm-button">✓</button>
                <button id="cancel-upload-btn" type="button" class="cancel-button">✗</button>
            </div>
        </div>
        
        <br><br>
        
        <button type="submit" id="save-profile-btn">Save Profile</button>
    </form>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('profile-form');
            const fileInput = document.getElementById('profile_picture');
            const previewImage = document.getElementById('profile-preview');
            const confirmButton = document.getElementById('confirm-upload-btn');
            const cancelButton = document.getElementById('cancel-upload-btn');
            const confirmSection = document.getElementById('confirm-section');
            const uploadSection = document.getElementById('upload-section');
            const saveButton = document.getElementById('save-profile-btn');
            
            // Store the original image source
            let originalImageSrc = previewImage.src;
            
            // Click on edit button to trigger file input
            uploadSection.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        previewImage.src = event.target.result;
                    }
                    
                    reader.readAsDataURL(e.target.files[0]);
                    
                    // Show confirmation section
                    confirmSection.style.display = 'block';
                }
            });
            
            confirmButton.addEventListener('click', function() {
                // Submit the form when user confirms
                form.submit();
            });
            
            cancelButton.addEventListener('click', function() {
                // Reset file input
                fileInput.value = '';
                
                // Restore original image
                previewImage.src = originalImageSrc;
                
                // Hide confirm section
                confirmSection.style.display = 'none';
            });
            
            saveButton.addEventListener('click', function(e) {
                // If there's a file selected, the confirmation UI should handle it
                // Otherwise, submit the form normally (for other profile updates)
                if (fileInput.files.length > 0) {
                    e.preventDefault();
                    // Let the confirmation UI handle it
                }
            });
        });
    </script>
</body>
</html>
